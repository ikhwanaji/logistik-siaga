// storage.rules
// ─────────────────────────────────────────────────────────────────────────────
// Firebase Storage Security Rules — LogistikSiaga
// Deploy with: firebase deploy --only storage
// ─────────────────────────────────────────────────────────────────────────────

rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {

    // ── Reports images ────────────────────────────────────────────────────────
    // Path: reports/{timestamp}_{uuid}.{ext}

    match /reports/{fileName} {

      // Anyone can read report images (public feed)
      allow read: if true;

      // Only authenticated users can upload
      allow write: if request.auth != null
        // Max 10MB
        && request.resource.size < 10 * 1024 * 1024
        // Only images
        && request.resource.contentType.matches("image/.*");

      // No delete (audit trail — use retention policy instead)
      allow delete: if false;
    }

    // ── Block all other paths ─────────────────────────────────────────────────
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}
